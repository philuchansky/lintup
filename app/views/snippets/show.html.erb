<h1><%= @snippet.title %></h1>
<div>by <%= link_to @snippet.user.username, user_path(@snippet.user) %> | <%= time_ago_in_words(@snippet.created_at) %> ago</div>
<h2>Language: <%= language_modes.find {|language| language[:language_mode] == @snippet.language}[:name] %></h2>
<textarea disabled id="snippet"><%= @snippet.content %></textarea>
<% if logged_in? %>
    <% if current_user.id == @snippet.user.id %>
        <%= link_to 'Edit', edit_snippet_path %> | <%= link_to 'Delete', delete_snippet_path(@snippet.id) %>
    <% else %>
		<% if current_user.already_likes?(@snippet) %>
            <%= link_to 'Unlike', controller: 'likes', action: 'destroy', id: @snippet.id %>
        <% else %>
			<%= link_to 'Like', controller: 'likes', action: 'create', id: @snippet.id %>
		<% end %>
    <% end %>
<% end %>

<hr>
Likes: <%= @snippet.likes.count %><br>
Comments: <%= @snippet.comments.count %>

<% @snippet.comments.each do |c| %>
    <div class="comment">
        <hr>
        <h4>From: <%= c.user.username %></h4>
	    <h5>Comment ID: <%= c.id %></h5>
        <textarea class="comment-body" disabled><%= c.body %></textarea>
	    <% if current_user == c.user || current_user == @snippet.user %>
	        <%= link_to 'Delete', delete_comment_path(c, :call_back_url => request.original_url) %>
	    <% end %>
    </div>
<% end %>

<hr>
<% if logged_in? %>
	<%= form_for(@comment, url: snippet_path(@snippet.id)) do |f|%>
	    Leave A Comment:<br>
	    <%= f.text_area :body %><br>
	    <%= f.submit 'Post Comment' %>
	<% end %>

	<script>

	</script>

<% else %>
	<%= link_to 'Create an account', new_user_path %> to leave comments.
<% end %>

<script>
	$(function(){
		var myTextArea = document.getElementById('snippet');
		var myCodeMirror = CodeMirror.fromTextArea(myTextArea, {
			lineNumbers: true,
			theme: 'monokai',
			lineWrapping: true,
			readOnly: true,
			mode: '<%= @snippet.language %>'
		});

		$('.comment-body').each(function(i, val){
			var commentRender = CodeMirror.fromTextArea(val, {
				lineNumbers: true,
				lineWrapping: true,
				readOnly: true,
				mode: 'markdown'
			})
		});

		var newComment = document.getElementById('comment_body');
		var commentCodeMirror = CodeMirror.fromTextArea(newComment, {
			lineNumbers: true,
			lineWrapping: true,
			mode: 'markdown'
		});
	})
</script>